{"version":3,"sources":["infinite-scroll.min.js"],"names":["root","factory","define","amd","exports","module","InfiniteScroll","this","options","autoLoad","container","$","finished","inject","item","pagination","requestConfig","context","dataType","url","attr","waitForImages","watcher","Watcher","buffer","scrollBuffer","callback","load","bind","watching","listener","validate","stop","prototype","items","append","ajax","then","process","data","$data","$items","find","updatePagination","imagesReady","start","$pagination","length","window","addEventListener","removeEventListener","innerHeight","pageYOffset","document","body","scrollHeight"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,eAAiBL,KAExBM,KAAM,WACR,YAiBA,SAASD,GAAeE,GAEtBD,KAAKE,SAAWD,EAAQC,YAAa,EAErCF,KAAKG,UAAYC,EAAEH,EAAQE,WAE3BH,KAAKK,UAAW,EAEZJ,EAAQK,SACVN,KAAKM,OAASL,EAAQK,QAGxBN,KAAKO,KAAON,EAAQM,KAEpBP,KAAKQ,WAAaP,EAAQO,WAE1BR,KAAKS,eACHC,QAASV,KACTW,SAAU,OACVC,IAAKR,EAAEJ,KAAKQ,YAAYK,KAAK,SAG/Bb,KAAKc,gBAAkBb,EAAQa,cAE/Bd,KAAKe,QAAU,GAAIC,IACjBC,OAAQhB,EAAQiB,aAChBC,SAAU,WACJnB,KAAKE,UAAUF,KAAKoB,QACxBC,KAAKrB,QA6EX,QAASgB,GAAQf,GACfD,KAAKiB,OAAShB,EAAQgB,QAAU,IAChCjB,KAAKmB,SAAWlB,EAAQkB,SACxBnB,KAAKsB,UAAW,EAEhBtB,KAAKuB,SAAW,WACVvB,KAAKwB,aACPxB,KAAKyB,OACLzB,KAAKmB,aAEPE,KAAKrB,MAwCT,MAzHAD,GAAe2B,WAEbpB,OAAS,SAASqB,GACZA,GACF3B,KAAKG,UAAUyB,OAAOD,IAK1BP,KAAO,WACL,MAAIpB,MAAKK,SAAT,OAEOD,EAAEyB,KAAK7B,KAAKS,eAChBqB,KAAK9B,KAAK+B,UAIfA,QAAU,SAASC,GACjB,GAAIC,GAAQ7B,EAAE,QAAU4B,EAAO,UAC3BE,EAASD,EAAME,KAAKnC,KAAKO,KAE7BP,MAAKoC,iBAAiBH,GAElBjC,KAAKc,cACPoB,EAAOG,cACJP,KAAK,WACJ9B,KAAKM,OAAO4B,GACZlC,KAAKsC,SACLjB,KAAKrB,QAGTA,KAAKM,OAAO4B,GACZlC,KAAKsC,UAKTA,MAAQ,WACFtC,KAAKK,UACTL,KAAKe,QAAQuB,SAIfb,KAAO,WACLzB,KAAKe,QAAQU,QAIfW,iBAAmB,SAASJ,GAC1B,GAAIO,GAAcP,EAAKG,KAAKnC,KAAKQ,WAC7B+B,GAAYC,OACdxC,KAAKS,cAAcG,IAAM2B,EAAY1B,KAAK,QAG1Cb,KAAKK,UAAW,IA+BtBW,EAAQU,WAKNY,MAAQ,WACFtC,KAAKsB,WAELtB,KAAKwB,WACPxB,KAAKmB,YAGLnB,KAAKsB,UAAW,EAChBmB,OAAOC,iBAAiB,SAAU1C,KAAKuB,aAQ3CE,KAAO,WACLgB,OAAOE,oBAAoB,SAAU3C,KAAKuB,UAC1CvB,KAAKsB,UAAW,GAOlBE,SAAW,WACT,MAAOiB,QAAOG,YAAcH,OAAOI,aAAeC,SAASC,KAAKC,aAAehD,KAAKiB,SAKjFlB","file":"infinite-scroll.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.InfiniteScroll = factory();\n  }\n}(this, function() {\n'use strict';\n\n\n/**\n * @name InfiniteScroll\n * @constructor\n *\n * @param {{}}                    options\n * @param {boolean}               [options.autoLoad=true]\n * @param {Element|jQuery|string} options.container\n * @param {Function}              [options.inject]\n * @param {string}                options.item\n * @param {string}                options.pagination\n * @param {number}                [options.scrollBuffer=150]\n * @param {boolean}               [options.waitForImages=false]\n *\n */\nfunction InfiniteScroll(options) {\n\n  this.autoLoad = options.autoLoad !== false;\n\n  this.container = $(options.container);\n\n  this.finished = false;\n\n  if (options.inject) {\n    this.inject = options.inject;\n  }\n\n  this.item = options.item;\n\n  this.pagination = options.pagination;\n\n  this.requestConfig = {\n    context: this,\n    dataType: 'html',\n    url: $(this.pagination).attr('href')\n  };\n\n  this.waitForImages = !!options.waitForImages;\n\n  this.watcher = new Watcher({\n    buffer: options.scrollBuffer,\n    callback: function(){\n      if (this.autoLoad) this.load();\n    }.bind(this)\n  });\n\n}\n\n\nInfiniteScroll.prototype = {\n\n  inject : function(items) {\n    if (items) {\n      this.container.append(items);\n    }\n  },\n\n\n  load : function() {\n    if (this.finished) return;\n\n    return $.ajax(this.requestConfig)\n      .then(this.process);\n  },\n\n\n  process : function(data) {\n    var $data = $('<div>' + data + '</div>');\n    var $items = $data.find(this.item);\n\n    this.updatePagination($data);\n\n    if (this.waitForImages) {\n      $items.imagesReady()\n        .then(function(){\n          this.inject($items);\n          this.start();\n        }.bind(this));\n    }\n    else {\n      this.inject($items);\n      this.start();\n    }\n  },\n\n\n  start : function() {\n    if (this.finished) return;\n    this.watcher.start();\n  },\n\n\n  stop : function() {\n    this.watcher.stop();\n  },\n\n\n  updatePagination : function(data) {\n    var $pagination = data.find(this.pagination);\n    if ($pagination.length) {\n      this.requestConfig.url = $pagination.attr('href');\n    }\n    else {\n      this.finished = true;\n    }\n  }\n\n};\n\n\n\n/**\n * @name Watcher\n * @constructor\n *\n * @param {{}}       options\n * @param {number}   [options.buffer=150]\n * @param {Function} options.callback\n *\n */\nfunction Watcher(options) {\n  this.buffer = options.buffer || 150;\n  this.callback = options.callback;\n  this.watching = false;\n\n  this.listener = function(){\n    if (this.validate()) {\n      this.stop();\n      this.callback();\n    }\n  }.bind(this);\n}\n\n\nWatcher.prototype = {\n\n  /**\n   *\n   */\n  start : function() {\n    if (this.watching) return;\n\n    if (this.validate()) {\n      this.callback();\n    }\n    else {\n      this.watching = true;\n      window.addEventListener('scroll', this.listener);\n    }\n  },\n\n\n  /**\n   *\n   */\n  stop : function() {\n    window.removeEventListener('scroll', this.listener);\n    this.watching = false;\n  },\n\n\n  /**\n   * @returns {boolean}\n   */\n  validate : function() {\n    return window.innerHeight + window.pageYOffset >= document.body.scrollHeight - this.buffer;\n  }\n\n};\n\nreturn InfiniteScroll;\n}));\n"],"sourceRoot":"/source/"}