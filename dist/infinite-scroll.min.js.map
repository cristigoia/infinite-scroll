{"version":3,"sources":["infinite-scroll.min.js"],"names":["root","factory","define","amd","exports","module","InfiniteScroll","this","options","eventEmitter","autoLoad","container","$","finished","inject","item","pagination","requestConfig","context","dataType","url","attr","waitForImages","watcher","Watcher","buffer","scrollBuffer","callback","load","bind","watching","listener","validate","stop","prototype","items","append","emit","ajax","then","process","data","$data","$items","find","updatePagination","imagesReady","start","$pagination","length","window","addEventListener","removeEventListener","innerHeight","pageYOffset","document","body","scrollHeight"],"mappings":"CAAE,SAASA,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACiB,gBAAZG,SAChBC,OAAOD,QAAUH,IAEjBD,EAAKM,eAAiBL,KAExBM,KAAM,WACR,YAiBA,SAASD,GAAeE,GAEtBC,cAAc,aAAc,WAAY,OAAQF,MAEhDA,KAAKG,SAAWF,EAAQE,YAAa,EAErCH,KAAKI,UAAYC,EAAEJ,EAAQG,WAE3BJ,KAAKM,UAAW,EAEZL,EAAQM,SACVP,KAAKO,OAASN,EAAQM,QAGxBP,KAAKQ,KAAOP,EAAQO,KAEpBR,KAAKS,WAAaR,EAAQQ,WAE1BT,KAAKU,eACHC,QAASX,KACTY,SAAU,OACVC,IAAKR,EAAEL,KAAKS,YAAYK,KAAK,SAG/Bd,KAAKe,gBAAkBd,EAAQc,cAE/Bf,KAAKgB,QAAU,GAAIC,IACjBC,OAAQjB,EAAQkB,aAChBC,SAAU,WACJpB,KAAKG,UAAUH,KAAKqB,QACxBC,KAAKtB,QAkFX,QAASiB,GAAQhB,GACfD,KAAKkB,OAASjB,EAAQiB,QAAU,IAChClB,KAAKoB,SAAWnB,EAAQmB,SACxBpB,KAAKuB,UAAW,EAEhBvB,KAAKwB,SAAW,WACVxB,KAAKyB,aACPzB,KAAK0B,OACL1B,KAAKoB,aAEPE,KAAKtB,MAwCT,MA9HAD,GAAe4B,WAEbpB,OAAS,SAASqB,GACZA,GACF5B,KAAKI,UAAUyB,OAAOD,IAK1BP,KAAO,WACL,MAAIrB,MAAKM,SAAT,QAEAN,KAAK8B,KAAK,cAEHzB,EAAE0B,KAAK/B,KAAKU,eAChBsB,KAAKhC,KAAKiC,WAIfA,QAAU,SAASC,GACjB,GAAIC,GAAQ9B,EAAE,QAAU6B,EAAO,UAC3BE,EAASD,EAAME,KAAKrC,KAAKQ,KAE7BR,MAAKsC,iBAAiBH,GAElBnC,KAAKe,cACPqB,EAAOG,cACJP,KAAK,WACJhC,KAAK8B,KAAK,YACV9B,KAAKO,OAAO6B,GACZpC,KAAKwC,SACLlB,KAAKtB,QAGTA,KAAK8B,KAAK,YACV9B,KAAKO,OAAO6B,GACZpC,KAAKwC,UAKTA,MAAQ,WACFxC,KAAKM,UACTN,KAAKgB,QAAQwB,SAIfd,KAAO,WACL1B,KAAKgB,QAAQU,QAIfY,iBAAmB,SAASJ,GAC1B,GAAIO,GAAcP,EAAKG,KAAKrC,KAAKS,WAC7BgC,GAAYC,OACd1C,KAAKU,cAAcG,IAAM4B,EAAY3B,KAAK,SAG1Cd,KAAKM,UAAW,EAChBN,KAAK8B,KAAK,UA+BhBb,EAAQU,WAKNa,MAAQ,WACFxC,KAAKuB,WAELvB,KAAKyB,WACPzB,KAAKoB,YAGLpB,KAAKuB,UAAW,EAChBoB,OAAOC,iBAAiB,SAAU5C,KAAKwB,aAQ3CE,KAAO,WACLiB,OAAOE,oBAAoB,SAAU7C,KAAKwB,UAC1CxB,KAAKuB,UAAW,GAOlBE,SAAW,WACT,MAAOkB,QAAOG,YAAcH,OAAOI,aAAeC,SAASC,KAAKC,aAAelD,KAAKkB,SAKjFnB","file":"infinite-scroll.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.InfiniteScroll = factory();\n  }\n}(this, function() {\n'use strict';\n\n\n/**\n * @name InfiniteScroll\n * @constructor\n *\n * @param {{}}                    options\n * @param {boolean}               [options.autoLoad=true]\n * @param {Element|jQuery|string} options.container\n * @param {Function}              [options.inject]\n * @param {string}                options.item\n * @param {string}                options.pagination\n * @param {number}                [options.scrollBuffer=150]\n * @param {boolean}               [options.waitForImages=false]\n *\n */\nfunction InfiniteScroll(options) {\n\n  eventEmitter(['load:start', 'load:end', 'end'], this);\n\n  this.autoLoad = options.autoLoad !== false;\n\n  this.container = $(options.container);\n\n  this.finished = false;\n\n  if (options.inject) {\n    this.inject = options.inject;\n  }\n\n  this.item = options.item;\n\n  this.pagination = options.pagination;\n\n  this.requestConfig = {\n    context: this,\n    dataType: 'html',\n    url: $(this.pagination).attr('href')\n  };\n\n  this.waitForImages = !!options.waitForImages;\n\n  this.watcher = new Watcher({\n    buffer: options.scrollBuffer,\n    callback: function(){\n      if (this.autoLoad) this.load();\n    }.bind(this)\n  });\n\n}\n\n\nInfiniteScroll.prototype = {\n\n  inject : function(items) {\n    if (items) {\n      this.container.append(items);\n    }\n  },\n\n\n  load : function() {\n    if (this.finished) return;\n\n    this.emit('load:start');\n\n    return $.ajax(this.requestConfig)\n      .then(this.process);\n  },\n\n\n  process : function(data) {\n    var $data = $('<div>' + data + '</div>');\n    var $items = $data.find(this.item);\n\n    this.updatePagination($data);\n\n    if (this.waitForImages) {\n      $items.imagesReady()\n        .then(function(){\n          this.emit('load:end');\n          this.inject($items);\n          this.start();\n        }.bind(this));\n    }\n    else {\n      this.emit('load:end');\n      this.inject($items);\n      this.start();\n    }\n  },\n\n\n  start : function() {\n    if (this.finished) return;\n    this.watcher.start();\n  },\n\n\n  stop : function() {\n    this.watcher.stop();\n  },\n\n\n  updatePagination : function(data) {\n    var $pagination = data.find(this.pagination);\n    if ($pagination.length) {\n      this.requestConfig.url = $pagination.attr('href');\n    }\n    else {\n      this.finished = true;\n      this.emit('end');\n    }\n  }\n\n};\n\n\n\n/**\n * @name Watcher\n * @constructor\n *\n * @param {{}}       options\n * @param {number}   [options.buffer=150]\n * @param {Function} options.callback\n *\n */\nfunction Watcher(options) {\n  this.buffer = options.buffer || 150;\n  this.callback = options.callback;\n  this.watching = false;\n\n  this.listener = function(){\n    if (this.validate()) {\n      this.stop();\n      this.callback();\n    }\n  }.bind(this);\n}\n\n\nWatcher.prototype = {\n\n  /**\n   *\n   */\n  start : function() {\n    if (this.watching) return;\n\n    if (this.validate()) {\n      this.callback();\n    }\n    else {\n      this.watching = true;\n      window.addEventListener('scroll', this.listener);\n    }\n  },\n\n\n  /**\n   *\n   */\n  stop : function() {\n    window.removeEventListener('scroll', this.listener);\n    this.watching = false;\n  },\n\n\n  /**\n   * @returns {boolean}\n   */\n  validate : function() {\n    return window.innerHeight + window.pageYOffset >= document.body.scrollHeight - this.buffer;\n  }\n\n};\n\nreturn InfiniteScroll;\n}));\n"],"sourceRoot":"/source/"}