{"version":3,"sources":["infinite-scroll.min.js"],"names":["root","factory","define","amd","exports","module","InfiniteScroll","this","eventEmitter","eventTypes","object","key","keys","Object","emitter","n","length","create","_events","getEvents","events","Array","isArray","TypeError","i","l","clone","listeners","cloned","indexOf","listener","fn","splice","index","j","k","pop","Watcher","options","buffer","callback","watching","validate","stop","bind","autoLoad","container","$","finished","inject","item","pagination","requestConfig","context","dataType","url","attr","waitForImages","watcher","scrollBuffer","load","on","addListener","type","scope","once","_getListeners","Error","that","fired","push","wrapper","data","removeListener","call","emit","removeAllListeners","event","listenerCount","prototype","start","window","addEventListener","removeEventListener","innerHeight","pageYOffset","document","body","scrollHeight","items","append","ajax","then","process","$data","$items","find","updatePagination","imagesReady","$pagination"],"mappings":"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","file":"infinite-scroll.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.InfiniteScroll = factory();\n  }\n}(this, function() {\n'use strict';\n\n\n/**\n * @name eventEmitter\n *\n * @param {string|string[]} eventTypes\n * @param {Object} [object]\n * @returns {Object}\n */\nfunction eventEmitter(eventTypes, object) { // eslint-disable-line no-unused-vars\n  if (object) {\n    var keys = Object.keys(emitter),\n        n = keys.length,\n        key;\n\n    while (n--) {\n      key = keys[n];\n      object[key] = emitter[key];\n    }\n  }\n  else {\n    object = Object.create(emitter); // eslint-disable-line no-param-reassign\n  }\n\n  object._events = getEvents(eventTypes);\n\n  return object;\n}\n\n\n/**\n * @param {string|string[]} eventTypes\n * @returns {Object.<string,Array>}\n */\nfunction getEvents(eventTypes) {\n  var events = {};\n\n  if (typeof eventTypes === 'string') {\n    events[eventTypes] = [];\n  }\n  else if (Array.isArray(eventTypes) && eventTypes.length) {\n    for (var i = 0, l = eventTypes.length; i < l; ++i) {\n      events[eventTypes[i]] = [];\n    }\n  }\n  else {\n    throw new TypeError('EventEmitter : `eventTypes` is required');\n  }\n\n  return events;\n}\n\n\nvar emitter = {};\n\n\n/**\n * @param {string} type\n * @param {Function} listener\n * @param {boolean|Object} [scope]\n * @param {boolean} [once]\n * @returns emitter\n */\nemitter.on =\nemitter.addListener = function(type, listener, scope, once) {\n  if (typeof listener !== 'function') {\n    throw new TypeError();\n  }\n\n  var listeners = this._getListeners(type);\n\n  if (listeners.length && indexOf(listeners, listener) !== -1) {\n    throw new Error();\n  }\n\n  if (scope === true || once === true) {\n    var that = this,\n        fired = false;\n\n    listeners.push({\n      fn: function wrapper(data) {\n        that.removeListener(type, wrapper);\n        if (!fired) {\n          fired = true;\n          listener.call(scope || {}, data);\n        }\n      },\n      scope: {}\n    });\n  }\n  else {\n    listeners.push({\n      fn: listener,\n      scope: scope || {}\n    });\n  }\n\n  return this;\n};\n\n\n/**\n * @param {string} type\n * @param {*} data\n * @returns emitter\n */\nemitter.emit = function(type, data) {\n  var listeners = this._getListeners(type);\n\n  if (listeners.length) {\n    listeners = clone(listeners);\n\n    for (var i = 0, l = listeners.length, listener; i < l; ++i) {\n      listener = listeners[i];\n      listener.fn.call(listener.scope, data);\n    }\n  }\n\n  return this;\n};\n\n\n/**\n * @param {string} type\n * @param {Function} listener\n * @returns emitter\n */\nemitter.removeListener = function(type, listener) {\n  var listeners = this._getListeners(type),\n      index;\n\n  if (listeners.length) {\n    index = indexOf(listeners, listener);\n    if (index !== -1) {\n      splice(listeners, index);\n    }\n  }\n\n  return this;\n};\n\n\n/**\n * @param {string} [type]\n * @returns emitter\n */\nemitter.removeAllListeners = function(type) {\n  if (typeof type === 'string') {\n    var listeners = this._getListeners(type);\n    listeners.length = 0;\n  }\n  else if (typeof type === 'undefined') {\n    var events = this._events;\n    for (var event in events) {\n      events[event].length = 0;\n    }\n  }\n\n  return this;\n};\n\n\n/**\n * @param {string} type\n * @returns {Array}\n */\nemitter.listeners = function(type) {\n  var listeners = this._getListeners(type);\n  return listeners.length ? clone(listeners) : [];\n};\n\n\n/**\n * @param {string} type\n * @returns {number}\n */\nemitter.listenerCount = function(type) {\n  var listeners = this._getListeners(type);\n  return listeners.length;\n};\n\n\n/**\n * @param {string} type\n * @returns {Array}\n * @throws {Error}\n */\nemitter._getListeners = function(type) {\n  var listeners = this._events[type];\n  if (!listeners) {\n    throw new Error('EventEmitter : event type `' + type + '` does not exist');\n  }\n  return listeners;\n};\n\n\n/**\n * @param {Array} listeners\n * @returns {Array}\n */\nfunction clone(listeners) {\n  var i = listeners.length,\n      cloned = new Array(i);\n\n  while (i--) {\n    cloned[i] = listeners[i];\n  }\n\n  return cloned;\n}\n\n\n/**\n * @param {Array} listeners\n * @param {Object} listener\n * @returns {number}\n */\nfunction indexOf(listeners, listener) {\n  var i = listeners.length;\n\n  while (i--) {\n    if (listener === listeners[i].fn) {\n      return i;\n    }\n  }\n\n  return -1;\n}\n\n\n/**\n * @param {Array} listeners\n * @param {number} index\n */\nfunction splice(listeners, index) {\n  for (var i = index, j = i + 1, k = listeners.length; j < k; ++i, ++j) {\n    listeners[i] = listeners[j];\n  }\n\n  listeners.pop();\n}\n\n/**\n * @name Watcher\n * @constructor\n *\n * @param {{}}       options\n * @param {number}   [options.buffer=150]\n * @param {Function} options.callback\n *\n */\nfunction Watcher(options) {\n  this.buffer = options.buffer || 150;\n  this.callback = options.callback;\n  this.watching = false;\n\n  this.listener = function(){\n    if (this.validate()) {\n      this.stop();\n      this.callback();\n    }\n  }.bind(this);\n}\n\n\nWatcher.prototype = {\n\n  /**\n   *\n   */\n  start : function() {\n    if (this.watching) return;\n\n    if (this.validate()) {\n      this.callback();\n    }\n    else {\n      this.watching = true;\n      window.addEventListener('scroll', this.listener);\n    }\n  },\n\n\n  /**\n   *\n   */\n  stop : function() {\n    window.removeEventListener('scroll', this.listener);\n    this.watching = false;\n  },\n\n\n  /**\n   * @returns {boolean}\n   */\n  validate : function() {\n    return window.innerHeight + window.pageYOffset >= document.body.scrollHeight - this.buffer;\n  }\n\n};\n\n'use strict';\n\n\n/**\n * @name InfiniteScroll\n * @constructor\n *\n * @param {{}}                    options\n * @param {boolean}               [options.autoLoad=true]\n * @param {Element|jQuery|string} options.container\n * @param {Function}              [options.inject]\n * @param {string}                options.item\n * @param {string}                options.pagination\n * @param {number}                [options.scrollBuffer=150]\n * @param {boolean}               [options.waitForImages=false]\n *\n */\nfunction InfiniteScroll(options) {\n\n  eventEmitter(['load:start', 'load:end', 'end'], this);\n\n  this.autoLoad = options.autoLoad !== false;\n\n  this.container = $(options.container);\n\n  this.finished = false;\n\n  if (options.inject) {\n    this.inject = options.inject;\n  }\n\n  this.item = options.item;\n\n  this.pagination = options.pagination;\n\n  this.requestConfig = {\n    context: this,\n    dataType: 'html',\n    url: $(this.pagination).attr('href')\n  };\n\n  this.waitForImages = !!options.waitForImages;\n\n  this.watcher = new Watcher({\n    buffer: options.scrollBuffer,\n    callback: function(){\n      if (this.autoLoad) this.load();\n    }.bind(this)\n  });\n\n}\n\n\nInfiniteScroll.prototype = {\n\n  inject : function(items) {\n    if (items) {\n      this.container.append(items);\n    }\n  },\n\n\n  load : function() {\n    if (this.finished) return;\n\n    this.emit('load:start');\n\n    return $.ajax(this.requestConfig)\n      .then(this.process);\n  },\n\n\n  process : function(data) {\n    var $data = $('<div>' + data + '</div>');\n    var $items = $data.find(this.item);\n\n    this.updatePagination($data);\n\n    if (this.waitForImages) {\n      $items.imagesReady()\n        .then(function(){\n          this.emit('load:end');\n          this.inject($items);\n          this.start();\n        }.bind(this));\n    }\n    else {\n      this.emit('load:end');\n      this.inject($items);\n      this.start();\n    }\n  },\n\n\n  start : function() {\n    if (this.finished) return;\n    this.watcher.start();\n  },\n\n\n  stop : function() {\n    this.watcher.stop();\n  },\n\n\n  updatePagination : function(data) {\n    var $pagination = data.find(this.pagination);\n    if ($pagination.length) {\n      this.requestConfig.url = $pagination.attr('href');\n    }\n    else {\n      this.finished = true;\n      this.emit('end');\n    }\n  }\n\n};\n\n\n\nreturn InfiniteScroll;\n}));\n"],"sourceRoot":"/source/"}